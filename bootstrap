#! /usr/bin/env bash

NAME='ms'

if [ "$EUID" -ne 0 ]
then
  echo ==================================
  echo Please be root
  echo ==================================
  exit 1
fi

echo ==================================
echo Update and Upgrade
echo ==================================
apt update
apt upgrade -y


echo ==================================
echo "Add user $NAME"
echo ==================================
read -s -p "Enter password : " password
pass=$(perl -e 'print crypt($ARGV[0], "4vLP%xYGrV!M5z")' $password)
echo "$pass"

useradd -m -p $pass $NAME|| echo "User '$NAME' exists"


echo ==================================
echo Installing sudo and adding user
echo ==================================
apt install sudo
adduser $NAME sudo

echo ==================================
echo Installing python3 and pip
echo ==================================
apt install python3 -y
apt install python3-pip -y

sudo -i -u $NAME bash << EOF
echo ==================================
echo Installing ansible as user \'$NAME\'
echo ==================================
mkdir -p /home/$NAME
python3 -m pip install --user ansible
ansible --version
EOF

echo ==================================
echo All done, have fun!
echo ==================================
